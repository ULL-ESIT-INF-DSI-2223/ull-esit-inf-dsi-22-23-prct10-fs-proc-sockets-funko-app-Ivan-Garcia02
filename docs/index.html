<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>dsi-prct010-fs-proc-sockets</title><meta name="description" content="Documentation for dsi-prct010-fs-proc-sockets"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">dsi-prct010-fs-proc-sockets</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2>dsi-prct010-fs-proc-sockets</h2></div>
<div class="tsd-panel tsd-typography">
<a href="#práctica-10---apis-asíncronas-de-gestión-del-sistema-de-ficheros-creación-de-procesos-y-creación-de-sockets-de-nodejs" id="práctica-10---apis-asíncronas-de-gestión-del-sistema-de-ficheros-creación-de-procesos-y-creación-de-sockets-de-nodejs" style="color: inherit; text-decoration: none;">
  <h1>Práctica 10 - APIs asíncronas de gestión del sistema de ficheros, creación de procesos y creación de sockets de Node.js</h1>
</a>

<a href="#desarrollo-de-sistemas-informáticos" id="desarrollo-de-sistemas-informáticos" style="color: inherit; text-decoration: none;">
  <h2>Desarrollo de Sistemas Informáticos</h2>
</a>
<blockquote>
<p><strong>Nombre:</strong> Iván García González <strong>Correo:</strong> <a href="mailto:alu0101388786@ull.edu.es">alu0101388786@ull.edu.es</a></p>
</blockquote>
<p align="center">
  <a href='https://coveralls.io/github/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct10-fs-proc-sockets-funko-app-Ivan-Garcia02?branch=main'>
    <img src='https://coveralls.io/repos/github/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct10-fs-proc-sockets-funko-app-Ivan-Garcia02/badge.svg?branch=main' alt='Coverage Status'>
  </a>

  <a href="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct10-fs-proc-sockets-funko-app-Ivan-Garcia02/actions/workflows/node.js.yml">
    <img alt="Tests" src="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct10-fs-proc-sockets-funko-app-Ivan-Garcia02/actions/workflows/node.js.yml/badge.svg">
  </a>

  <a href="https://sonarcloud.io/summary/new_code?id=ULL-ESIT-INF-DSI-2223_ull-esit-inf-dsi-22-23-prct10-fs-proc-sockets-funko-app-Ivan-Garcia02">
    <img alt="Quality Gate Status" src="https://sonarcloud.io/api/project_badges/measure?project=ULL-ESIT-INF-DSI-2223_ull-esit-inf-dsi-22-23-prct10-fs-proc-sockets-funko-app-Ivan-Garcia02&metric=alert_status">
  </a>
</p>



<a href="#índice" id="índice" style="color: inherit; text-decoration: none;">
  <h2>Índice</h2>
</a>
<ul>
<li><a href="#objetivos-de-la-pr%C3%A1ctica">Objetivos</a></li>
<li><a href="#ejercicios-propuestos">Ejercicios propuestos</a><ul>
<li><a href="#ejercicio-1">Ejercicio 1</a></li>
<li><a href="#ejercicio-2">Ejercicio 2</a></li>
<li><a href="#ejercicio-3---cliente-y-servidor-para-aplicaci%C3%B3n-de-registro-de-funko-pops">Ejercicio 3</a></li>
</ul>
</li>
<li><a href="#ejercicio-modificaci%C3%B3n">Ejercicio modificación</a></li>
<li><a href="#conclusiones">Conclusiones</a></li>
<li><a href="#bibliograf%C3%ADa">Bibliografía</a></li>
</ul>

<a href="#objetivos-de-la-práctica" id="objetivos-de-la-práctica" style="color: inherit; text-decoration: none;">
  <h2>Objetivos de la práctica</h2>
</a>
<p>En esta práctica vamos a profundizar en los conceptos explicados en clase, sobre Node.js, las APIs asíncronas de gestión del sistema de ficheros (módulo <code>fs</code>), de creación de procesos (módulo <code>child_process</code>) y de creación de sockets (módulo <code>net</code>) de Node.js. y los paquetes <code>yargs</code> y <code>chalk</code>.</p>

<a href="#ejercicios-propuestos" id="ejercicios-propuestos" style="color: inherit; text-decoration: none;">
  <h2>Ejercicios propuestos</h2>
</a>

<a href="#ejercicio-1" id="ejercicio-1" style="color: inherit; text-decoration: none;">
  <h3>Ejercicio 1</h3>
</a>

<a href="#traza-de-ejecución" id="traza-de-ejecución" style="color: inherit; text-decoration: none;">
  <h4>Traza de ejecución</h4>
</a>
<p>Ejecutamos el programa, inicialmente con todos los registros vacíos. Vamos a ejecutar el programa con un archivo existente y que se pasa correctamente por parámetros, por lo que pasamos a la línea 8 directamente, a la llamada del <code>access</code>.</p>
<pre><code class="language-markdown"><span class="hl-0">Pila de llamadas:</span><br/><span class="hl-1">-</span><span class="hl-0"> access</span><br/><span class="hl-0">Registro de eventos de la API:</span><br/><span class="hl-1">-</span><span class="hl-0"> vacio</span><br/><span class="hl-0">Cola de manejadores:</span><br/><span class="hl-1">-</span><span class="hl-0"> vacio</span><br/><br/><span class="hl-0">Console:</span><br/><span class="hl-2">&gt;</span><span class="hl-0"> Starting to watch file helloworld.txt</span><br/><span class="hl-2">&gt;</span><span class="hl-0"> File helloworld.txt is no longer watched</span>
</code></pre>
<p>Como no se ha producido ninguna modificación en el fichero hasta ahora solo tenemos la llamada a <code>access</code>. A continuación, realizamos la primera modificación en el archivo <code>helloworld.txt</code>.</p>
<pre><code class="language-markdown"><span class="hl-0">Pila de llamadas:</span><br/><span class="hl-1">-</span><span class="hl-0"> watch</span><br/><span class="hl-1">-</span><span class="hl-0"> access</span><br/><span class="hl-0">Registro de eventos de la API:</span><br/><span class="hl-1">-</span><span class="hl-0"> change (callback de watch)</span><br/><span class="hl-0">Cola de manejadores:</span><br/><span class="hl-1">-</span><span class="hl-0"> vacio</span><br/><br/><span class="hl-0">Console:</span><br/><span class="hl-2">&gt;</span><span class="hl-0"> File helloworld.txt has been modified somehow</span>
</code></pre>
<p>En este punto ya se introduce a la pila de llamadas la función <code>watch</code> tras la modificación y se añade al registro de eventos de la API a la callback <code>change</code>. Ahora, realizamos la segunda modificación del archivo <code>helloworld.txt</code>.</p>
<pre><code class="language-markdown"><span class="hl-0">Pila de llamadas:</span><br/><span class="hl-1">-</span><span class="hl-0"> watch</span><br/><span class="hl-1">-</span><span class="hl-0"> access</span><br/><span class="hl-0">Registro de eventos de la API:</span><br/><span class="hl-1">-</span><span class="hl-0"> change (callback del segundo watch)</span><br/><span class="hl-0">Cola de manejadores:</span><br/><span class="hl-1">-</span><span class="hl-0"> change (callback del primer watch)</span><br/><br/><span class="hl-0">Console:</span><br/><span class="hl-2">&gt;</span><span class="hl-0"> File helloworld.txt has been modified somehow</span>
</code></pre>
<p>Aquí, ya pasado un tiempo, el primer manejador de <code>change</code> ya se ha movido a la cola, y se ha añadido un nuevo manejador <code>change</code> con la nueva modificación al registro de eventos de la API.</p>

<a href="#¿qué-hace-la-función-access" id="¿qué-hace-la-función-access" style="color: inherit; text-decoration: none;">
  <h4>¿Qué hace la función access?</h4>
</a>
<p>La función <code>access</code> se utiliza para comprobar si un archivo existe y si es accesible para el proceso en ejecución, esta prueba los permisos del usuario para el archivo o directorio especificado en la ruta <code>path</code>. En este caso, comprueba si el archivo proporcionado existe, antes de empezar a vigilarlo para detectar cambios.</p>

<a href="#¿para-qué-sirve-el-objeto-constants" id="¿para-qué-sirve-el-objeto-constants" style="color: inherit; text-decoration: none;">
  <h4>¿Para qué sirve el objeto constants?</h4>
</a>
<p>El objeto constants es un entero opcional que especifica las verificaciones de accesibilidad que se deben realizar, como por ejemplo, los modos de apertura de archivos o los permisos de acceso. En este caso, se utiliza la constante <code>F_OK</code>, que indica que el archivo es visible para el proceso que lo llama, pero no dice nada sobre los permisos <em>rwx</em>. Esto es util para indicar que solo se desea comprobar la existencia del archivo.</p>

<a href="#ejercicio-2" id="ejercicio-2" style="color: inherit; text-decoration: none;">
  <h3>Ejercicio 2</h3>
</a>
<p>Para este ejercicio nos pedían implementar una aplicación que proporcione información sobre el número de líneas, palabras o caracteres que contiene un fichero de texto. Hemos hecho dos funciones una haciendo uso del método <code>pipe</code> de un <code>Stream</code> y otra sin hacer uso de este.</p>
<p>En ambas funciones los parámetros que se pasan como argumento son el fichero a analizar y las opciones (Información de líneas y/o palabras y/o caracteres además del fichero de nuevo). Al comienzo de las funciones lo primero que hacemos en ambas es comprobar que tenemos acceso al fichero con la función asincrona <code>access</code>. En caso de no tener acceso, se emite un mensaje de error y en caso de tener acceso al fichero si implementa la aplicación según con <code>pipe</code> o no.</p>

<a href="#wcconpipe" id="wcconpipe" style="color: inherit; text-decoration: none;">
  <h4>wcConPipe</h4>
</a>
<p>Para esta función lo primero que hacemos es crear el proceso con <code>spawn</code>, en el que indicamos que queremos usar el comando <code>wc</code> con las opciones indicadas por parámetros. A continuación, redirigimos la salida del proceso <code>wc</code> a la estándar de consola con un <code>pipe</code>.</p>
<pre><code class="language-typescript"><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-4">wc</span><span class="hl-0"> = </span><span class="hl-5">spawn</span><span class="hl-0">(</span><span class="hl-6">&#39;wc&#39;</span><span class="hl-0">, </span><span class="hl-7">options</span><span class="hl-0">);</span><br/><span class="hl-7">wc</span><span class="hl-0">.</span><span class="hl-7">stdout</span><span class="hl-0">.</span><span class="hl-5">pipe</span><span class="hl-0">(</span><span class="hl-7">process</span><span class="hl-0">.</span><span class="hl-7">stdout</span><span class="hl-0">);</span>
</code></pre>

<a href="#wcsinpipe" id="wcsinpipe" style="color: inherit; text-decoration: none;">
  <h4>wcSinPipe</h4>
</a>
<p>Para esta función lo primero que hacemos también será crear el proceso con <code>spawn</code>, en el que indicamos que queremos usar el comando <code>wc</code> con las opciones indicadas por parámetros. A continuación, creamos la variable <code>wcOutput</code> que vamos a utilizar para ir almacenando el contenido del stream <code>wc</code>, con el evento <code>data</code>. Después, con el evento <code>close</code>, separamos la variable <code>wcOutput</code> en un array para trabajar mejor y según las opciones seleccionadas imprimir la información del fichero.</p>
<pre><code class="language-typescript"><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-4">wc</span><span class="hl-0"> = </span><span class="hl-5">spawn</span><span class="hl-0">(</span><span class="hl-6">&#39;wc&#39;</span><span class="hl-0">, </span><span class="hl-7">options</span><span class="hl-0">);</span><br/><br/><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-7">wcOutput</span><span class="hl-0">: </span><span class="hl-8">string</span><span class="hl-0"> = </span><span class="hl-6">&#39;&#39;</span><span class="hl-0">;</span><br/><span class="hl-7">wc</span><span class="hl-0">.</span><span class="hl-7">stdout</span><span class="hl-0">.</span><span class="hl-5">on</span><span class="hl-0">(</span><span class="hl-6">&#39;data&#39;</span><span class="hl-0">, (</span><span class="hl-7">piece</span><span class="hl-0">) </span><span class="hl-3">=&gt;</span><span class="hl-0"> </span><span class="hl-7">wcOutput</span><span class="hl-0"> += </span><span class="hl-7">piece</span><span class="hl-0">);</span><br/><br/><span class="hl-7">wc</span><span class="hl-0">.</span><span class="hl-5">on</span><span class="hl-0">(</span><span class="hl-6">&#39;close&#39;</span><span class="hl-0">, () </span><span class="hl-3">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-4">wcOutputAsArray</span><span class="hl-0"> = </span><span class="hl-7">wcOutput</span><span class="hl-0">.</span><span class="hl-5">split</span><span class="hl-0">(</span><span class="hl-9">/\s</span><span class="hl-10">+</span><span class="hl-9">/</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-7">position</span><span class="hl-0">: </span><span class="hl-8">number</span><span class="hl-0"> = </span><span class="hl-11">0</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-12">if</span><span class="hl-0"> (</span><span class="hl-7">wcOutputAsArray</span><span class="hl-0">[</span><span class="hl-11">0</span><span class="hl-0">] == </span><span class="hl-6">&#39;&#39;</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-7">position</span><span class="hl-0"> = </span><span class="hl-11">1</span><span class="hl-0">;</span><br/><span class="hl-0">  }</span><br/><br/><span class="hl-0">  </span><span class="hl-12">if</span><span class="hl-0"> (</span><span class="hl-7">options</span><span class="hl-0">.</span><span class="hl-5">find</span><span class="hl-0">(</span><span class="hl-7">op</span><span class="hl-0"> </span><span class="hl-3">=&gt;</span><span class="hl-0"> </span><span class="hl-7">op</span><span class="hl-0"> === </span><span class="hl-6">&#39;-l&#39;</span><span class="hl-0">)) {</span><br/><span class="hl-0">    </span><span class="hl-7">console</span><span class="hl-0">.</span><span class="hl-5">log</span><span class="hl-0">(</span><span class="hl-6">`El fichero </span><span class="hl-3">${</span><span class="hl-7">fichero</span><span class="hl-3">}</span><span class="hl-6">, tiene </span><span class="hl-3">${</span><span class="hl-7">wcOutputAsArray</span><span class="hl-13">[</span><span class="hl-7">position</span><span class="hl-0">++</span><span class="hl-13">]</span><span class="hl-3">}</span><span class="hl-6"> lineas`</span><span class="hl-0">);</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">  </span><span class="hl-12">if</span><span class="hl-0"> (</span><span class="hl-7">options</span><span class="hl-0">.</span><span class="hl-5">find</span><span class="hl-0">(</span><span class="hl-7">op</span><span class="hl-0"> </span><span class="hl-3">=&gt;</span><span class="hl-0"> </span><span class="hl-7">op</span><span class="hl-0"> === </span><span class="hl-6">&#39;-w&#39;</span><span class="hl-0">)) {</span><br/><span class="hl-0">    </span><span class="hl-7">console</span><span class="hl-0">.</span><span class="hl-5">log</span><span class="hl-0">(</span><span class="hl-6">`El fichero </span><span class="hl-3">${</span><span class="hl-7">fichero</span><span class="hl-3">}</span><span class="hl-6">, tiene </span><span class="hl-3">${</span><span class="hl-7">wcOutputAsArray</span><span class="hl-13">[</span><span class="hl-7">position</span><span class="hl-0">++</span><span class="hl-13">]</span><span class="hl-3">}</span><span class="hl-6"> palabras`</span><span class="hl-0">);</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">  </span><span class="hl-12">if</span><span class="hl-0"> (</span><span class="hl-7">options</span><span class="hl-0">.</span><span class="hl-5">find</span><span class="hl-0">(</span><span class="hl-7">op</span><span class="hl-0"> </span><span class="hl-3">=&gt;</span><span class="hl-0"> </span><span class="hl-7">op</span><span class="hl-0"> === </span><span class="hl-6">&#39;-c&#39;</span><span class="hl-0">)) {</span><br/><span class="hl-0">    </span><span class="hl-7">console</span><span class="hl-0">.</span><span class="hl-5">log</span><span class="hl-0">(</span><span class="hl-6">`El fichero </span><span class="hl-3">${</span><span class="hl-7">fichero</span><span class="hl-3">}</span><span class="hl-6">, tiene </span><span class="hl-3">${</span><span class="hl-7">wcOutputAsArray</span><span class="hl-13">[</span><span class="hl-7">position</span><span class="hl-13">]</span><span class="hl-3">}</span><span class="hl-6"> caracteres`</span><span class="hl-0">);</span><br/><span class="hl-0">  }</span><br/><br/><span class="hl-0">  </span><span class="hl-12">if</span><span class="hl-0">(</span><span class="hl-7">options</span><span class="hl-0">.</span><span class="hl-7">length</span><span class="hl-0"> === </span><span class="hl-11">1</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-7">console</span><span class="hl-0">.</span><span class="hl-5">log</span><span class="hl-0">(</span><span class="hl-6">`El fichero </span><span class="hl-3">${</span><span class="hl-7">fichero</span><span class="hl-3">}</span><span class="hl-6">, tiene </span><span class="hl-3">${</span><span class="hl-7">wcOutputAsArray</span><span class="hl-13">[</span><span class="hl-7">position</span><span class="hl-0">++</span><span class="hl-13">]</span><span class="hl-3">}</span><span class="hl-6"> lineas`</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-7">console</span><span class="hl-0">.</span><span class="hl-5">log</span><span class="hl-0">(</span><span class="hl-6">`El fichero </span><span class="hl-3">${</span><span class="hl-7">fichero</span><span class="hl-3">}</span><span class="hl-6">, tiene </span><span class="hl-3">${</span><span class="hl-7">wcOutputAsArray</span><span class="hl-13">[</span><span class="hl-7">position</span><span class="hl-0">++</span><span class="hl-13">]</span><span class="hl-3">}</span><span class="hl-6"> palabras`</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-7">console</span><span class="hl-0">.</span><span class="hl-5">log</span><span class="hl-0">(</span><span class="hl-6">`El fichero </span><span class="hl-3">${</span><span class="hl-7">fichero</span><span class="hl-3">}</span><span class="hl-6">, tiene </span><span class="hl-3">${</span><span class="hl-7">wcOutputAsArray</span><span class="hl-13">[</span><span class="hl-7">position</span><span class="hl-13">]</span><span class="hl-3">}</span><span class="hl-6"> caracteres`</span><span class="hl-0">);</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">});</span>
</code></pre>

<a href="#indexts" id="indexts" style="color: inherit; text-decoration: none;">
  <h4>index.ts</h4>
</a>
<p>En este fichero definiremos el código encargado de la interacción con el usuario a través de la línea de comandos, para ello vamos a hacer uso del paquete <code>yargs</code>.</p>
<p>Definimos un comando que es <code>wc</code> y que pide un fichero <code>file</code> y como opcionales se pueden poner las opciones de <code>lines</code>, <code>words</code> y <code>chars</code>. Según las opciones indicadas, se incluyen en un vector para después llamar a las funciones <code>wcConPipe</code> y <code>wcSinPipe</code>, con el fichero y las opciones seleccionadas.</p>

<a href="#ejercicio-3---cliente-y-servidor-para-aplicación-de-registro-de-funko-pops" id="ejercicio-3---cliente-y-servidor-para-aplicación-de-registro-de-funko-pops" style="color: inherit; text-decoration: none;">
  <h3>Ejercicio 3 - Cliente y servidor para aplicación de registro de Funko Pops</h3>
</a>
<p>Para este ejercicio nos pedían, que partiendo de la implementación de la práctica anterior de <em>FunkoApp</em>, escribiéramos un servidor y un cliente haciendo uso de los sockets proporcionados por el módulo net de Node.js. Por ello tenemos el fichero <code>funko.ts</code> que contiene la declaración de la clase <code>Funko</code> para declarar funkos.</p>

<a href="#servidorts" id="servidorts" style="color: inherit; text-decoration: none;">
  <h4>servidor.ts</h4>
</a>
<p>El servidor será el encargado de procesar la petición, preparar y envíar una respuesta de vuelta al cliente, es por ello que lo primero que hacemos es crear el servidor con <code>net.createServer((connection)</code> y ponernos a escuchar en el puerto correspondiente. A continuación, cuando recibamos un evento <code>data</code>, lo parseamos, y creamos el array de funkos a partir de los ficheros correspondientes al usuario de la petición, para ello usamos las funciones asíncronas <code>access</code>, <code>readdir</code> y <code>readFile</code> y cuando estas hayan terminado de analizar todos los ficheros e incluirlos a la colección de Funkos, emitiremos un evento con el tipo de petición a realizar:</p>
<ul>
<li><p><strong>add:</strong> Lo primero que haremos es parsear el mensaje, para sí no existe el ID a incluir en la colección, crearlo y guardarlo en ficheros haciendo uso de la función <code>writeFunkoFile</code> que hará uso de las funciones asíncronas <code>access</code>, <code>mkdir</code> y <code>writeFile</code>. A continuación, creamos la respuesta, la enviamos al cliente y cerramos la conexión con este. En caso de que el ID existiese mandamos un mensaje con el valor <code>sucess</code> a <em>false</em>.</p>
</li>
<li><p><strong>update:</strong> Lo primero que haremos es parsear el mensaje, para sí existe el ID a modificar en la colección, modificarlo y guardarlo en ficheros haciendo uso de la función <code>writeFunkoFile</code> que hará uso de las funciones asíncronas <code>access</code>, <code>mkdir</code> y <code>writeFile</code>. A continuación, creamos la respuesta, la enviamos al cliente y cerramos la conexión con este. En caso de que el ID no existiese mandamos un mensaje con el valor <code>sucess</code> a <em>false</em>.</p>
</li>
<li><p><strong>remove:</strong> Lo primero que haremos es parsear el mensaje, para sí existe el ID a eliminar de la colección, eliminarlo de los ficheros haciendo uso de las función asincrona <code>rm</code>. A continuación, creamos la respuesta, la enviamos al cliente y cerramos la conexión con este. En caso de que el ID no existiese mandamos un mensaje con el valor <code>sucess</code> a <em>false</em>.</p>
</li>
<li><p><strong>show:</strong> Lo primero que haremos es parsear el mensaje, para sí existe el ID a mostrar de la colección, crear la respuesta en la que incluimos un array con el funko a mostrar y enviarlo al cliente y cerramos la conexión con este. En caso de que el ID no existiese mandamos un mensaje con el valor <code>sucess</code> a <em>false</em>.</p>
</li>
<li><p><strong>list:</strong> Lo primero que haremos es parsear el mensaje, después creamos la respuesta en la que incluimos un array con los funkos a mostrar y enviarlos al cliente y cerramos la conexión con este.</p>
</li>
</ul>

<a href="#clientets" id="clientets" style="color: inherit; text-decoration: none;">
  <h4>cliente.ts</h4>
</a>
<p>El cliente será el encargado de haciendo uso de <code>yargs</code>, se introduzcan todos los datos y el comando a ejecutar, para construir una petición y mandársela al servidor. Para ello con <code>yargs</code> obtenemos todos los datos necesarios, al igual que en la práctica anterior, para guardarlos en unas variables globales que usará el cliente.</p>
<p>A continuación, creamos una conexión con el servidor con <code>net</code> y aprovechamos para, desde la conexión, realizar un envío de datos al servidor con <code>write</code>, en la que en formato JSON enviamos la petición que construimos en el yargs.</p>
<p>Después, cuando reciba datos los irá almacenando en <code>wholeData</code>, para cuando el servidor emite un evento <code>end</code> y cierre la conexión, el cliente parsea los datos recibidos y en un <code>switch-case</code> según el comando a ejecutar y si hubo exito o no, imprimir un mensaje personalizado de exito o no (haciendo uso de <code>chalk</code>) y en el caso de mostrar funkos imprimir los funkos también.</p>

<a href="#ejercicio-modificación" id="ejercicio-modificación" style="color: inherit; text-decoration: none;">
  <h2>Ejercicio Modificación</h2>
</a>
<p>En este ejercicio nos pedían escribir un servidor y un cliente haciendo uso de los sockets proporcionados por el módulo <code>net</code> de Node.js. De tal forma que el cliente hiciera una petición de un comando a ejecutar al servidor, el servidor la ejecuta y le envía la salida del comando al cliente.</p>

<a href="#clientets-1" id="clientets-1" style="color: inherit; text-decoration: none;">
  <h4>cliente.ts</h4>
</a>
<p>Para ello en el código del cliente, primero comprobamos que al menos recibimos 3 parámetros (con el comando a ejecutar por el servidor). A continuación, creamos una conexión con el servidor con <code>net</code> y aprovechamos para desde la conexión, realizar un envío de datos al servidor con <code>write</code>, en la que en formato JSON enviamos el comando a ejecutar y sus opciones.</p>
<p>A continuación, cuando reciba datos los irá almacenando en <code>wholeData</code>, para cuando el servidor emite un evento <code>end</code> y cierre la conexión el cliente parsea los datos recibidos y los imprime por pantalla.</p>
<pre><code class="language-typescript"><span class="hl-12">if</span><span class="hl-0"> (</span><span class="hl-7">process</span><span class="hl-0">.</span><span class="hl-7">argv</span><span class="hl-0">.</span><span class="hl-7">length</span><span class="hl-0"> &lt; </span><span class="hl-11">3</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-7">console</span><span class="hl-0">.</span><span class="hl-5">log</span><span class="hl-0">(</span><span class="hl-6">&#39;Por favor introduzca un comando.&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">} </span><span class="hl-12">else</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-7">opciones</span><span class="hl-0">: </span><span class="hl-8">string</span><span class="hl-0">[] = [];</span><br/><span class="hl-0">  </span><span class="hl-12">for</span><span class="hl-0"> (</span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-7">i</span><span class="hl-0"> = </span><span class="hl-11">3</span><span class="hl-0">; </span><span class="hl-7">i</span><span class="hl-0"> &lt; </span><span class="hl-7">process</span><span class="hl-0">.</span><span class="hl-7">argv</span><span class="hl-0">.</span><span class="hl-7">length</span><span class="hl-0">; </span><span class="hl-7">i</span><span class="hl-0">++) {</span><br/><span class="hl-0">    </span><span class="hl-7">opciones</span><span class="hl-0">.</span><span class="hl-5">push</span><span class="hl-0">(</span><span class="hl-7">process</span><span class="hl-0">.</span><span class="hl-7">argv</span><span class="hl-0">[</span><span class="hl-7">i</span><span class="hl-0">]);</span><br/><span class="hl-0">  }</span><br/><br/><span class="hl-0">  </span><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-4">client</span><span class="hl-0"> = </span><span class="hl-7">net</span><span class="hl-0">.</span><span class="hl-5">connect</span><span class="hl-0">({</span><span class="hl-7">port:</span><span class="hl-0"> </span><span class="hl-11">60300</span><span class="hl-0">}, () </span><span class="hl-3">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-7">client</span><span class="hl-0">.</span><span class="hl-5">write</span><span class="hl-0">(</span><span class="hl-4">JSON</span><span class="hl-0">.</span><span class="hl-5">stringify</span><span class="hl-0">({</span><span class="hl-6">&#39;comando&#39;</span><span class="hl-7">:</span><span class="hl-0"> </span><span class="hl-7">process</span><span class="hl-0">.</span><span class="hl-7">argv</span><span class="hl-0">[</span><span class="hl-11">2</span><span class="hl-0">], </span><span class="hl-6">&#39;opciones&#39;</span><span class="hl-7">:</span><span class="hl-0"> </span><span class="hl-7">opciones</span><span class="hl-0">}));</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-7">wholeData</span><span class="hl-0"> = </span><span class="hl-6">&#39;&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-7">client</span><span class="hl-0">.</span><span class="hl-5">on</span><span class="hl-0">(</span><span class="hl-6">&#39;data&#39;</span><span class="hl-0">, (</span><span class="hl-7">dataChunk</span><span class="hl-0">) </span><span class="hl-3">=&gt;</span><span class="hl-0"> { </span><br/><span class="hl-0">    </span><span class="hl-7">wholeData</span><span class="hl-0"> += </span><span class="hl-7">dataChunk</span><span class="hl-0">;</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-7">client</span><span class="hl-0">.</span><span class="hl-5">on</span><span class="hl-0">(</span><span class="hl-6">&#39;end&#39;</span><span class="hl-0">, () </span><span class="hl-3">=&gt;</span><span class="hl-0"> { </span><br/><span class="hl-0">    </span><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-4">message</span><span class="hl-0"> = </span><span class="hl-4">JSON</span><span class="hl-0">.</span><span class="hl-5">parse</span><span class="hl-0">(</span><span class="hl-7">wholeData</span><span class="hl-0">);</span><br/><br/><span class="hl-0">    </span><span class="hl-12">if</span><span class="hl-0">(</span><span class="hl-7">message</span><span class="hl-0">.</span><span class="hl-7">flag</span><span class="hl-0">) {</span><br/><span class="hl-0">      </span><span class="hl-7">console</span><span class="hl-0">.</span><span class="hl-5">log</span><span class="hl-0">(</span><span class="hl-6">&#39;Salida del comando: </span><span class="hl-14">\n</span><span class="hl-6">&#39;</span><span class="hl-0"> + </span><span class="hl-7">message</span><span class="hl-0">.</span><span class="hl-7">salida</span><span class="hl-0">);</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">    </span><span class="hl-12">else</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-7">console</span><span class="hl-0">.</span><span class="hl-5">log</span><span class="hl-0">(</span><span class="hl-6">&#39;Error en el comando&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  });</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#servidorts-1" id="servidorts-1" style="color: inherit; text-decoration: none;">
  <h4>servidor.ts</h4>
</a>
<p>En la parte del servidor lo primero que hacemos es crear el servidor con <code>net.createServer((connection)</code> y ponernos a escuchar en el puerto correspondiente. A continuación, cuando recibamos un evento <code>data</code>, lo parseamos, y creamos un proceso con <code>spawn</code> para ejecutarlo. Después obtenemos la información de salida del comando y la enviamos al cliente con un <code>write</code> para, a continuación, cerrar la conexión con el cliente <code>end</code>.</p>
<pre><code class="language-typescript"><span class="hl-7">net</span><span class="hl-0">.</span><span class="hl-5">createServer</span><span class="hl-0">((</span><span class="hl-7">connection</span><span class="hl-0">) </span><span class="hl-3">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-7">console</span><span class="hl-0">.</span><span class="hl-5">log</span><span class="hl-0">(</span><span class="hl-6">&#39;A client has connected.&#39;</span><span class="hl-0">);</span><br/><span class="hl-0"> </span><br/><span class="hl-0">  </span><span class="hl-7">connection</span><span class="hl-0">.</span><span class="hl-5">on</span><span class="hl-0">(</span><span class="hl-6">&#39;data&#39;</span><span class="hl-0">, (</span><span class="hl-7">dataJSON</span><span class="hl-0">) </span><span class="hl-3">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-4">message</span><span class="hl-0"> = </span><span class="hl-4">JSON</span><span class="hl-0">.</span><span class="hl-5">parse</span><span class="hl-0">(</span><span class="hl-7">dataJSON</span><span class="hl-0">.</span><span class="hl-5">toString</span><span class="hl-0">());</span><br/><span class="hl-0">    </span><span class="hl-7">console</span><span class="hl-0">.</span><span class="hl-5">log</span><span class="hl-0">(</span><span class="hl-6">&#39;Comando a ejecutar: &#39;</span><span class="hl-0"> + </span><span class="hl-7">message</span><span class="hl-0">.</span><span class="hl-7">comando</span><span class="hl-0"> + </span><span class="hl-6">&#39; &#39;</span><span class="hl-0"> + </span><span class="hl-7">message</span><span class="hl-0">.</span><span class="hl-7">opciones</span><span class="hl-0">);</span><br/><br/><span class="hl-0">    </span><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-4">comando</span><span class="hl-0"> = </span><span class="hl-5">spawn</span><span class="hl-0">(</span><span class="hl-7">message</span><span class="hl-0">.</span><span class="hl-7">comando</span><span class="hl-0">, </span><span class="hl-7">message</span><span class="hl-0">.</span><span class="hl-7">opciones</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-7">comandoOutput</span><span class="hl-0"> = </span><span class="hl-6">&#39;&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-7">comando</span><span class="hl-0">.</span><span class="hl-7">stdout</span><span class="hl-0">.</span><span class="hl-5">on</span><span class="hl-0">(</span><span class="hl-6">&#39;data&#39;</span><span class="hl-0">, (</span><span class="hl-7">piece</span><span class="hl-0">) </span><span class="hl-3">=&gt;</span><span class="hl-0"> </span><span class="hl-7">comandoOutput</span><span class="hl-0"> += </span><span class="hl-7">piece</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><br/><span class="hl-0">    </span><span class="hl-7">comando</span><span class="hl-0">.</span><span class="hl-5">on</span><span class="hl-0">(</span><span class="hl-6">&#39;close&#39;</span><span class="hl-0">, () </span><span class="hl-3">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-7">connection</span><span class="hl-0">.</span><span class="hl-5">write</span><span class="hl-0">(</span><span class="hl-4">JSON</span><span class="hl-0">.</span><span class="hl-5">stringify</span><span class="hl-0">({</span><span class="hl-6">&#39;flag&#39;</span><span class="hl-7">:</span><span class="hl-0"> </span><span class="hl-3">true</span><span class="hl-0">, </span><span class="hl-6">&#39;salida&#39;</span><span class="hl-7">:</span><span class="hl-0"> </span><span class="hl-7">comandoOutput</span><span class="hl-0">}));</span><br/><span class="hl-0">      </span><span class="hl-7">connection</span><span class="hl-0">.</span><span class="hl-5">end</span><span class="hl-0">();</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-7">connection</span><span class="hl-0">.</span><span class="hl-5">on</span><span class="hl-0">(</span><span class="hl-6">&#39;close&#39;</span><span class="hl-0">, () </span><span class="hl-3">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-7">console</span><span class="hl-0">.</span><span class="hl-5">log</span><span class="hl-0">(</span><span class="hl-6">&#39;A client has disconnected.&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><span class="hl-0">}).</span><span class="hl-5">listen</span><span class="hl-0">(</span><span class="hl-11">60300</span><span class="hl-0">, () </span><span class="hl-3">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-7">console</span><span class="hl-0">.</span><span class="hl-5">log</span><span class="hl-0">(</span><span class="hl-6">&#39;Waiting for clients to connect.&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">});</span>
</code></pre>

<a href="#conclusiones" id="conclusiones" style="color: inherit; text-decoration: none;">
  <h2>Conclusiones</h2>
</a>
<p>En esta práctica hemos realizado varios ejercicios con los que hemos practicado los conceptos explicados en clase, sobre Node.js, las APIs asíncronas de gestión del sistema de ficheros (módulo <code>fs</code>), de creación de procesos (módulo <code>child_process</code>) y de creación de sockets (módulo <code>net</code>) de Node.js. y los paquetes <code>yargs</code> y <code>chalk</code>.</p>
<p>En concreto, he practicado más profundamente las funciones de la API asíncrona de Node.js, <code>writefile</code>, <code>readfile</code>, <code>access</code>, <code>mkdir</code> y <code>rm</code>. Además de los eventos a emitir por sockets <code>data</code>, <code>end</code>...</p>

<a href="#bibliografía" id="bibliografía" style="color: inherit; text-decoration: none;">
  <h2>Bibliografía</h2>
</a>
<ul>
<li><a href="https://ull-esit-inf-dsi-2223.github.io/prct10-fs-proc-sockets-funko-app/">Guion de la práctica</a></li>
<li><a href="https://ull-esit-inf-dsi-2223.github.io/prct09-filesystem-funko-app/">Guion de la práctica anterior</a></li>
<li><a href="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct09-funko-app-Ivan-Garcia02">Repositorio de la práctica anterior</a></li>
<li><a href="https://ull-esit-inf-dsi-2223.github.io/nodejs-theory/">Apuntes de la asignatura</a></li>
</ul>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">dsi-<wbr/>prct010-<wbr/>fs-<wbr/>proc-<wbr/>sockets</a>
<ul>
<li class="tsd-kind-module"><a href="modules/ejercicio_2.html">ejercicio-<wbr/>2</a></li>
<li class="tsd-kind-module"><a href="modules/ejercicio_2_wcConPipe.html">ejercicio-<wbr/>2/wc<wbr/>Con<wbr/>Pipe</a></li>
<li class="tsd-kind-module"><a href="modules/ejercicio_2_wcSinPipe.html">ejercicio-<wbr/>2/wc<wbr/>Sin<wbr/>Pipe</a></li>
<li class="tsd-kind-module"><a href="modules/ejercicio_3_cliente.html">ejercicio-<wbr/>3/cliente</a></li>
<li class="tsd-kind-module"><a href="modules/ejercicio_3_funko.html">ejercicio-<wbr/>3/funko</a></li>
<li class="tsd-kind-module"><a href="modules/ejercicio_3_servidor.html">ejercicio-<wbr/>3/servidor</a></li></ul></li></ul></div></details></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>